{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Back Button -->
        <div class="mb-4">
            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                ‚¨ÖÔ∏è Back to Events
            </a>
        </div>
        
        <!-- Event Detail Card -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                    <div class="mb-2 mb-md-0">
                        <small class="text-muted">üè¢ {{ event.source_name }}</small>
                    </div>
                    <span class="badge bg-primary fs-6">{{ event.category.title() }}</span>
                </div>
            </div>
            
            <div class="card-body">
                <!-- Event Title -->
                <h1 class="card-title mb-4">{{ event.name }}</h1>
                
                <!-- Event Details Grid -->
                <div class="row">
                    <div class="col-md-6">
                        <!-- Date and Time -->
                        <div class="mb-4">
                            <h5>üìÖ Date & Time</h5>
                            {% if event.date_time %}
                                <p class="mb-1">
                                    <strong>Date:</strong> {{ event.date_time.strftime('%A, %B %d, %Y') }}
                                </p>
                                <p class="mb-0">
                                    <strong>Time:</strong> <span class="text-primary">{{ event.date_time.strftime('%I:%M %p') }}</span>
                                </p>
                            {% else %}
                                <p class="text-muted">Date and time to be announced</p>
                            {% endif %}
                        </div>
                        
                        <!-- Location -->
                        <div class="mb-4">
                            <h5>üìç Location</h5>
                            <p>{{ event.location or 'Location to be announced' }}</p>
                        </div>
                        
                        <!-- Cost -->
                        {% if event.cost %}
                        <div class="mb-4">
                            <h5>üí∞ Cost</h5>
                            <p class="text-success fs-5"><strong>{{ event.cost }}</strong></p>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6">
                        <!-- Organizer -->
                        {% if event.organizer %}
                        <div class="mb-4">
                            <h5>üë• Organizer</h5>
                            <p>{{ event.organizer }}</p>
                        </div>
                        {% endif %}
                        
                        <!-- Contact Information -->
                        {% if event.contact_info %}
                        <div class="mb-4">
                            <h5>üìû Contact Information</h5>
                            <p>{{ event.contact_info }}</p>
                        </div>
                        {% endif %}
                        
                        <!-- Registration -->
                        <div class="mb-4">
                            <h5>üìù Registration</h5>
                            {% if event.registration_required %}
                                <span class="badge bg-warning text-dark fs-6">Registration Required</span>
                            {% else %}
                                <span class="badge bg-success fs-6">No Registration Required</span>
                            {% endif %}
                        </div>
                        
                        <!-- Age Restrictions -->
                        {% if event.age_restrictions %}
                        <div class="mb-4">
                            <h5>üë∂ Age Requirements</h5>
                            <p>{{ event.age_restrictions }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Description -->
                <div class="row">
                    <div class="col-12">
                        <div class="mb-4">
                            <h5>üìñ Description</h5>
                            <div class="description-text">
                                <p>{{ event.description or 'No description available.' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex flex-column flex-sm-row gap-3">
                            {% if event.source_url and not 'waltham-events.local' in event.source_url %}
                            <a href="{{ event.source_url }}" target="_blank" class="btn btn-primary">
                                üîó Visit Original Source
                            </a>
                            {% endif %}
                            
                            {% if event.contact_info and '@' in event.contact_info %}
                            <a href="mailto:{{ event.contact_info.split('|')[0].strip() }}" class="btn btn-outline-primary">
                                ‚úâÔ∏è Send Email
                            </a>
                            {% endif %}
                            
                            {% if event.organizer %}
                            <button class="btn btn-outline-info" onclick="searchOrganizer('{{ event.organizer }}')">
                                üîç Find More from {{ event.organizer }}
                            </button>
                            {% endif %}
                            
                            <button class="btn btn-outline-secondary" onclick="shareEvent()">
                                üì§ Share Event
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card-footer text-muted">
                <small>
                    Event ID: #{{ event.id }}
                    {% if event.created_at %}
                    | Added: {{ event.created_at.strftime('%B %d, %Y') }}
                    {% endif %}
                </small>
            </div>
        </div>
    </div>
</div>

<script>
function shareEvent() {
    if (navigator.share) {
        navigator.share({
            title: '{{ event.name }}',
            text: '{{ event.description[:100] }}...',
            url: window.location.href
        });
    } else {
        // Fallback: Copy to clipboard
        navigator.clipboard.writeText(window.location.href).then(function() {
            alert('Event URL copied to clipboard!');
        });
    }
}

function searchOrganizer(organizer) {
    // Search for more events from the same organizer
    const searchUrl = '/?search=' + encodeURIComponent(organizer);
    window.open(searchUrl, '_blank');
}
</script>
{% endblock %}
